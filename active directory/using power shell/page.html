<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Using Power Shell</title>
</head><body>[System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()<br/>
<br/>
([adsi]'').distinguishedName<br/>
<br/>
$PDC = [System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain().PdcRoleOwner.Name $DN = ([adsi]'').distinguishedName $LDAP = "LDAP://$PDC/$DN" $LDAP &nbsp; <br/>
<br/>
<br/>
$direntry = New-Object System.DirectoryServices.DirectoryEntry($LDAP) $dirsearcher = New-Object System.DirectoryServices.DirectorySearcher($direntry) $dirsearcher.FindAll() &nbsp; <br/>
<br/>
$dirsearcher = New-Object System.DirectoryServices.DirectorySearcher($direntry) $dirsearcher.filter="samAccountType=805306368" $dirsearcher.FindAll() &nbsp; <br/>
<br/>
$result = $dirsearcher.FindAll() Foreach($obj in $result) { Foreach($prop in $obj.Properties) { $prop } Write-Host "-------------------------------" } &nbsp; &nbsp;<br/>
<br/>
$dirsearcher = New-Object System.DirectoryServices.DirectorySearcher($direntry) $dirsearcher.filter="name=jeffadmin" $result = $dirsearcher.FindAll() Foreach($obj in $result) { Foreach($prop in $obj.Properties) { $prop.memberof } Write-Host "-------------------------------" } &nbsp; <br/>
<br/>
$dirsearcher = New-Object System.DirectoryServices.DirectorySearcher($direntry) $dirsearcher.filter="name=jeffadmin" $result = $dirsearcher.FindAll() Foreach($obj in $result) { Foreach($prop in $obj.Properties) { $prop.memberof } Write-Host "-------------------------------" } &nbsp; <br/>
<br/>
function LDAPSearch { param ( [string]$LDAPQuery ) $PDC = [System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain().PdcRoleOwner.Name $DistinguishedName = ([adsi]'').distinguishedName $DirectoryEntry = New-Object System.DirectoryServices.DirectoryEntry("LDAP://$PDC/$DistinguishedName") $DirectorySearcher = New-Object System.DirectoryServices.DirectorySearcher($DirectoryEntry, $LDAPQuery) return $DirectorySearcher.FindAll() } &nbsp; <br/>
<br/>
LDAPSearch -LDAPQuery "(samAccountType=805306368)"<br/>
<br/>
LDAPSearch -LDAPQuery "(objectclass=group)"<br/>
<br/>
foreach ($group in $(LDAPSearch -LDAPQuery "(objectCategory=group)")) { $group.properties | select {$_.cn}, {$_.member} }<br/>
<br/>
$sales = LDAPSearch -LDAPQuery "(&amp;(objectCategory=group)(cn=Sales Department))"<br/>
<br/>
$sales.properties.member<br/>
<br/>
$user = LDAPSearch -LDAPQuery "(&amp;(objectCategory=user)(cn=michelle*))"<br/>
<br/>
$group.Properties.member<br/>
<br/>
$user.Properties</body></html>